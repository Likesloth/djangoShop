{% extends 'myapp/layout/base.html' %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">
  <!-- Header Card -->
  <div class="bg-white/90 backdrop-blur-xl rounded-3xl border-2 border-gray-100 shadow-xl overflow-hidden mb-6">
    <div class="px-6 py-4 bg-gradient-to-r from-indigo/10 via-purple-500/10 to-pink/10 border-b-2 border-gray-100">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <h2 class="text-2xl font-bold text-gray-800">Request #{{ pr.id }}</h2>
        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-xl text-sm font-bold border-2
          {% if pr.status == 'PENDING' %}border-amber-300 text-amber-700 bg-amber-50
          {% elif pr.status == 'READY' %}border-emerald-300 text-emerald-700 bg-emerald-50
          {% elif pr.status == 'PICKED_UP' %}border-blue-300 text-blue-700 bg-blue-50
          {% elif pr.status == 'PREPARING' %}border-indigo-300 text-indigo-700 bg-indigo-50
          {% elif pr.status == 'CANCELED' %}border-gray-300 text-gray-700 bg-white
          {% else %}border-gray-300 text-gray-700 bg-white{% endif %}">
          {{ pr.get_status_display }}
        </span>
      </div>
    </div>
    <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <div class="text-xs font-bold text-gray-600 uppercase">Requester</div>
        <div class="text-gray-800 font-semibold">{{ pr.requester.username }}</div>
      </div>
      <div>
        <div class="text-xs font-bold text-gray-600 uppercase">Pickup Location</div>
        <div class="text-gray-800 font-semibold">{{ pr.pickup_location|default:'Main Desk' }}</div>
      </div>
      <div>
        <div class="text-xs font-bold text-gray-600 uppercase">Pickup By</div>
        <div class="text-gray-800 font-semibold">{{ pr.pickup_by|date:'Y-m-d' }}</div>
      </div>
      <div>
        <div class="text-xs font-bold text-gray-600 uppercase">Requested</div>
        <div class="text-gray-800">{{ pr.requested_at|date:'M d, Y H:i' }}</div>
      </div>
      {% if pr.ready_at %}
      <div>
        <div class="text-xs font-bold text-gray-600 uppercase">Ready At</div>
        <div class="text-gray-800">{{ pr.ready_at|date:'M d, Y H:i' }}</div>
      </div>
      {% endif %}
      {% if pr.picked_up_at %}
      <div>
        <div class="text-xs font-bold text-gray-600 uppercase">Picked Up At</div>
        <div class="text-gray-800">{{ pr.picked_up_at|date:'M d, Y H:i' }}</div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Items Card -->
  <div class="bg-white/90 backdrop-blur-xl rounded-3xl border-2 border-gray-100 shadow-xl overflow-hidden mb-6">
    <div class="px-6 py-4 bg-gradient-to-r from-indigo/10 via-purple-500/10 to-pink/10 border-b-2 border-gray-100">
      <h3 class="text-lg font-bold text-gray-800">Items</h3>
    </div>
    <div class="hidden md:grid grid-cols-12 gap-2 px-6 py-3 bg-gray-50 border-b-2 border-gray-200 text-xs font-bold text-gray-600 uppercase tracking-wider">
      <div class="col-span-5">Title</div>
      <div class="col-span-3">Assigned Copy</div>
      <div class="col-span-4">Assign</div>
    </div>
    <div class="divide-y divide-gray-100">
      {% for it in pr.items.all %}
        <div class="grid grid-cols-1 md:grid-cols-12 gap-3 px-6 py-4 items-start hover:bg-indigo/5">
          <div class="md:col-span-5 text-gray-800 font-medium">{{ it.book.title }}</div>
          <div class="md:col-span-3">
            {% if it.assigned_copy %}
              <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-emerald-100 border border-emerald-200 rounded-lg text-xs font-mono text-emerald-800">{{ it.assigned_copy.barcode }}</span>
              <form method="post" action="{% url 'staff-request-unassign-item' pr.id it.id %}" class="inline-block ml-2">
                {% csrf_token %}
                <button class="px-3 py-1.5 rounded-xl border-2 border-red-300 text-red-600 hover:bg-red-50 text-xs font-semibold transition-all" type="submit">Unassign</button>
              </form>
            {% else %}
              <span class="text-gray-500 italic">Not assigned</span>
            {% endif %}
          </div>
          <div class="md:col-span-4">
            <form method="post" action="{% url 'staff-request-assign-item' pr.id it.id %}" class="flex gap-2">
              {% csrf_token %}
              <input type="text" name="barcode" placeholder="Scan/enter barcode" class="flex-1 rounded-xl bg-white border-2 border-gray-200 px-4 py-2.5 text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo focus:border-indigo transition-all" />
              <button class="px-4 py-2.5 rounded-xl border-2 border-emerald-300 text-emerald-700 hover:bg-emerald-50 text-sm font-semibold transition-all" type="submit">Assign</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Footer Actions -->
  <div class="flex flex-wrap gap-3">
    <a class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border-2 border-gray-300 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-400 font-semibold transition-all" href="{% url 'staff-requests-queue' %}">Back</a>
    <form method="post" action="{% url 'staff-request-mark-ready' pr.id %}">
      {% csrf_token %}
      <button class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-semibold shadow" type="submit">Mark Ready</button>
    </form>
    <form method="post" action="{% url 'staff-request-confirm-pickup' pr.id %}">
      {% csrf_token %}
      <button class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white font-semibold shadow" type="submit">Confirm Pickup</button>
    </form>
    <form method="post" action="{% url 'staff-request-cancel' pr.id %}">
      {% csrf_token %}
      <button class="inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border-2 border-red-300 bg-red-50 text-red-600 hover:bg-red-100 hover:border-red-400 font-semibold" type="submit">Cancel</button>
    </form>
  </div>
</div>
{% endblock %}

