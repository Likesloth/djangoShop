{% extends 'myapp/layout/base.html' %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h2 class="mb-1">{{ book.title }}</h2>
      <div class="text-muted-contrast">ISBN: {{ book.isbn13 }} • {{ book.language }} • {{ book.publish_year }}</div>
      <div class="text-muted-contrast">Authors: {% for author in book.authors.all %}{% if not forloop.first %}, {% endif %}{{ author.full_name }}{% empty %}—{% endfor %}</div>
    </div>
    <div>
      <div class="text-end">
        <span class="badge bg-success">Available: {{ available_count }}</span>
        {% if request.user.is_authenticated %}
          <div class="mt-2">
            <a href="{% url 'cart-add' book.id %}" class="btn btn-sm btn-primary">Add to Cart</a>
            <a href="{% url 'cart-view' %}" class="btn btn-sm btn-outline-secondary">View Cart</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="card glass-card">
    <div class="card-header bg-light">Copies</div>
    <div class="table-responsive">
      <table class="table table-sm table-striped align-middle mb-0">
        <thead>
          <tr>
            <th>Barcode</th>
            <th>Location</th>
            <th>Status</th>
            {% if request.user.is_staff or request.user.is_superuser %}
              <th style="width: 280px;">Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for copy in copies %}
            <tr>
              <td class="fw-semibold">{{ copy.barcode }}</td>
              <td>{{ copy.location }}</td>
              <td>
                {% if copy.status == 'AVAILABLE' %}
                  <span class="badge bg-success">Available</span>
                {% elif copy.status == 'ON_LOAN' %}
                  <span class="badge bg-warning text-dark">On loan</span>
                {% elif copy.status == 'RESERVED' %}
                  <span class="badge bg-info text-dark">Reserved</span>
                {% elif copy.status == 'REPAIR' %}
                  <span class="badge bg-secondary">Repair</span>
                {% elif copy.status == 'LOST' %}
                  <span class="badge bg-danger">Lost</span>
                {% else %}
                  <span class="badge bg-light text-dark">{{ copy.status }}</span>
                {% endif %}
              </td>
              {% if request.user.is_staff or request.user.is_superuser %}
                <td>
                  <div class="d-flex gap-1 flex-wrap">
                    <a class="btn btn-sm btn-primary" href="{% url 'circulation-desk' %}?barcode={{ copy.barcode }}">Desk</a>
                    <a class="btn btn-sm btn-outline-success" href="{% url 'staff-copy-status' copy.id 'AVAILABLE' %}">Available</a>
                    <a class="btn btn-sm btn-outline-warning" href="{% url 'staff-copy-status' copy.id 'REPAIR' %}">Repair</a>
                    <a class="btn btn-sm btn-outline-danger" href="{% url 'staff-copy-status' copy.id 'LOST' %}">Lost</a>
                  </div>
                </td>
              {% endif %}
            </tr>
          {% empty %}
            <tr>
              <td colspan="3" class="text-muted">No copies yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  

  <div class="mt-3">
    <a href="{% url 'catalog-list' %}" class="btn btn-outline-secondary">Back to catalog</a>
  </div>
</div>
{% endblock content %}
