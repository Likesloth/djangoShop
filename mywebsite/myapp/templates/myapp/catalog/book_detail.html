{% extends 'myapp/layout/base.html' %}

{% block content %}
<div class="container py-4">
  <div class="flex items-start justify-between gap-4 mb-3">
    <div>
      <h2 class="text-2xl font-bold text-slate-900 mb-1">{{ book.title }}</h2>
      <div class="text-slate-600">ISBN: {{ book.isbn13 }} • {{ book.language }} • {{ book.publish_year }}</div>
      <div class="text-slate-600">Authors: {% for author in book.authors.all %}{% if not forloop.first %}, {% endif %}{{ author.full_name }}{% empty %}—{% endfor %}</div>
    </div>
    <div class="text-right">
      <span class="inline-flex items-center px-2.5 py-1.5 rounded-md border border-emerald-300 text-emerald-700 bg-emerald-50 text-sm font-medium">Available: {{ available_count }}</span>
      {% if request.user.is_authenticated %}
        <div class="mt-2 flex gap-2 justify-end">
          <a href="{% url 'cart-add' book.id %}" class="inline-flex items-center px-3 py-2 rounded-md bg-indigo text-white hover:opacity-90 shadow text-sm">Add to Cart</a>
          <a href="{% url 'cart-view' %}" class="inline-flex items-center px-3 py-2 rounded-md border border-gray-300 text-slate-700 hover:bg-gray-50 text-sm">View Cart</a>
        </div>
      {% endif %}
    </div>
  </div>

  {% if book.cover %}
    <div class="mb-3">
      <img src="{{ book.cover.url }}" alt="{{ book.title }} cover" class="rounded-md" style="max-height:220px;width:auto;" />
    </div>
  {% endif %}

  <div class="rounded-2xl border border-peach-400/70 bg-white/70 backdrop-blur-md overflow-hidden">
    <div class="px-4 py-2 bg-lavender/40 text-slate-800 font-semibold">Copies</div>
    <div class="overflow-x-auto">
      <table class="min-w-full align-middle">
        <thead class="bg-lavender/40 text-slate-700 text-sm">
          <tr>
            <th class="text-left px-4 py-2">Barcode</th>
            <th class="text-left px-4 py-2">Location</th>
            <th class="text-left px-4 py-2">Status</th>
            {% if request.user.is_staff or request.user.is_superuser %}
              <th class="text-left px-4 py-2" style="width: 280px;">Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody class="divide-y divide-peach-300/60">
          {% for copy in copies %}
            <tr>
              <td class="px-4 py-2 font-semibold">{{ copy.barcode }}</td>
              <td class="px-4 py-2">{{ copy.location }}</td>
              <td class="px-4 py-2">
                {% if copy.status == 'AVAILABLE' %}
                  <span class="inline-flex items-center px-2 py-1 rounded-md border border-emerald-300 text-emerald-700 bg-emerald-50 text-xs font-medium">Available</span>
                {% elif copy.status == 'ON_LOAN' %}
                  <span class="inline-flex items-center px-2 py-1 rounded-md border border-amber-300 text-amber-800 bg-amber-50 text-xs font-medium">On loan</span>
                {% elif copy.status == 'RESERVED' %}
                  <span class="inline-flex items-center px-2 py-1 rounded-md border border-sky-300 text-sky-800 bg-sky-50 text-xs font-medium">Reserved</span>
                {% elif copy.status == 'REPAIR' %}
                  <span class="inline-flex items-center px-2 py-1 rounded-md border border-gray-300 text-slate-700 bg-gray-50 text-xs font-medium">Repair</span>
                {% elif copy.status == 'LOST' %}
                  <span class="inline-flex items-center px-2 py-1 rounded-md border border-red-300 text-red-700 bg-red-50 text-xs font-medium">Lost</span>
                {% else %}
                  <span class="inline-flex items-center px-2 py-1 rounded-md border border-gray-300 text-slate-700 bg-white text-xs font-medium">{{ copy.status }}</span>
                {% endif %}
              </td>
              {% if request.user.is_staff or request.user.is_superuser %}
                <td class="px-4 py-2">
                  <div class="flex flex-wrap gap-1">
                    <a class="inline-flex items-center px-2.5 py-1.5 rounded-md border border-emerald-300 text-emerald-700 hover:bg-emerald-50 text-sm" href="{% url 'staff-copy-status' copy.id 'AVAILABLE' %}">Available</a>
                    <a class="inline-flex items-center px-2.5 py-1.5 rounded-md border border-amber-300 text-amber-700 hover:bg-amber-50 text-sm" href="{% url 'staff-copy-status' copy.id 'REPAIR' %}">Repair</a>
                    <a class="inline-flex items-center px-2.5 py-1.5 rounded-md border border-red-300 text-red-700 hover:bg-red-50 text-sm" href="{% url 'staff-copy-status' copy.id 'LOST' %}">Lost</a>
                  </div>
                </td>
              {% endif %}
            </tr>
          {% empty %}
            <tr>
              <td colspan="3" class="px-4 py-3 text-slate-600">No copies yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-3">
    <a href="{% url 'catalog-list' %}" class="inline-flex items-center px-3 py-2 rounded-md border border-gray-300 text-slate-700 hover:bg-gray-50">Back to catalog</a>
  </div>
</div>
{% endblock content %}
